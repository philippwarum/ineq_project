---
title: "Länderübergreifende Einkommensverteilung der EU"
subtitle: "2063 - Ökonomie der Verteilung"
author: "Isabelle Wabnegger & Philipp Warum"
abstract: "In dieser Arbeit geben wir einen Überblick zum Stand und zur Entwicklung der länderübergreifenden Einkommensverteilung der EU im Zeitraum von 2007 bis 2016 auf Basis von EU-SILC Daten. Wir berechnen gängige Verteilungsmaße für drei unterschiedliche Einkommensvariablen und zwei Grundgesamtheiten. Darüber hinaus führen wir eine Theil Index Zerlegung durch."
date: '`r format(Sys.time(), "%d %B, %Y")`'
output:
  pdf_document:
    toc: true
    number_sections: true
    toc_depth: 2

bibliography: references.bib

header-includes:
 \usepackage{float}
 \floatplacement{figure}{H} 
---

```{r global_options, include=FALSE}
knitr::opts_chunk$set(fig.pos = 'H')
options(knitr.kable.NA = '') 
```


```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
```


```{r, include=FALSE, message=FALSE, warning=FALSE}
# load packages
library(dplyr)
library(latticeExtra)
library(RColorBrewer)
library(ggplot2)
library(stringr)
library(reshape2)
```

```{r include=FALSE, warning=FALSE}
#load data

load("../../data/eu28_indicators.RData")

#prep data
indicators.p1 <- indicators.p1 %>% filter(year %in% c(2007:2016))
indicators.p1 <- mutate_all(indicators.p1, function(x) as.double(as.character(x)))

theil.p1 <- theil.p1 %>% select(-contains("2004"), -contains("2005"), -contains("2006"), -contains("2017"))

indicators.p2 <- indicators.p2 %>% filter(year %in% c(2007:2016))
indicators.p2 <- mutate_all(indicators.p2, function(x) as.double(as.character(x)))

theil.p2 <- theil.p2 %>% select(-contains("2004"), -contains("2005"), -contains("2006"), -contains("2017"))


```




\newpage

# Einführung

In dieser Arbeit geben wir einen Überblick zum Stand und zur Entwicklung der länderübergreifenden Einkommensverteilung der EU im Zeitraum von 2007 bis 2016 auf Basis von EU-SILC Daten. Wir berechnen gängige Verteilungsmaße für drei unterschiedliche Einkommensvariablen und zwei Grundgesamtheiten. Darüber hinaus führen wir eine Theil Index Zerlegung durch.


# Literatur

Der Zusammenschluss der Länder zu einem Wirtschaftsraum und einer Währungsgemeinschaft, der Europäischen Union, soll eine Annäherung auf verschiedenen Ebenen herbeiführen. Am Beispiel der Ungleichheit der Einkommen, spiegeln sich verschiedene Einflüsse wieder. 
Ein grundlegender Faktor ist das Wirtschaftswachstum. @Fredriksen(2012)  legte hierauf den Fokus seiner Forschung. Er stellte dabei fest, dass die obere Perzentile der Einkommen bei positiver Entwicklung der Volkswirtschaft am meisten profitiert. 

Ein weiterer Gesichtspunkt im Bezug auf die Einkommensverteilung ist die geographische Anordnung. Es ist zu beobachten, dass innerhalb der Länder inwirtschaftlich „stärkere“ und „schwächere“ Regionen untereilt werden kann. Dieser räumliche Faktor sowie die Konvergenz der Einkommen innerhalb der EU wurde von @Paas(2006) analysiert. Ihre Forschungsergebnisse zeigen auf, dass die Einkommen vor allem zwischen den ursprünglichen EU-15 und den neueren Mitgliedsstaaten signifikant divergieren. Allerdings ist erkennbar, dass die regionale Ungleichheit bereits auf nationaler Ebene zu Spannungen führen kann. Dies auszugleichen ist oft eine Herausforderung für die Politik auf nationaler Ebene, und noch eine größere auf supranationaler Ebene.
Die Publikation von @Beblo(2001) wurde in den Anfängen der EU veröffentlicht und gilt für die weitere Forschung oft als Grundlage. Sie konzipieren die Idee eines Eurolandes und berechnen dafür den Theil-Index.Für die EURO10 basierend auf Daten von 1995 ECHP beträgt dieser 0,1849. Ein von @Papatheodorou und Pavlopoulos (2014) aktualisierter Theil-Index von 0,148 beinhaltet die EU15 Staaten und wurde mit EU SILC Daten von 2008 berechnet. @Kranzinger (2018) hat ebenso EU SILC verwendet und den Theil- Index für die EU-28 für 2014 mit 0,215 berechnet.
Oben genannte Autoren beschäftigen sich auch mit der Frage der Einkommensverteilungen anhand demographischer Gruppen innerhalb der Länder. Dabei wurden Haushalte nach Alter eingeteilt. Es wird in Gruppen je nach Alter des Oberhauptes eingeteilt. Es wurde die EU sowie die einzelnen Länder analysiert., Dabei stellte sich heraus, dass die Ungleichheit in älteren Haushalten höher ist als die in den Jüngeren. Die Unterschiede zwischen alt und jung lassen sich zum einen auf die Pensionssysteme rückführen, zum anderen auf die davor erwirtschafteten Einkommen, auf die sich die Pensionen beziehen.
 



# Methodologie


## Daten

Zur Untersuchung der länderübergreifenden Einkommensverteilung der EU28 verwenden wir Daten der EU-SILC Erhebung (European Union Statistics on Income and Living Conditions), da diese für den Zeitraum in welchem sie verfügbar sind eine national repräsentative sowie international vergleichbare Datenquelle darstellen, welche nur die Nachteile aufweist die üblicherweise mit Umfrageerhebungen einhergehen. Ebenjene Schwachstellen, wie etwa der "non-response bias", werden nachträglich durch Gewichtung korrigiert, so dass von einer Annäherung der berechneten Verteilungsmaße an ihre realen Größen innerhalb der Bevölkerung auszugehen ist. Für unsere Zwecke ist vor allem die internationale Vergleichbarkeit der EU SILC Daten hervorzuheben. Das Höchstmaß an Vereinheitlichung von Fragestellungen und (Einkommens-)definitionen ermöglicht erst die Konstruktion von Verteilungsmaßen auf länderübergreifender Ebene. 

Für die gegenständliche Analyse stehen EU SILC Daten von 2004 bis 2017 zur Verfügung. Da wir eine Untersuchung der Einkommensverteilung der EU anstreben, können aber nicht alle Daten miteinbezogen werden. So werden erst ab 2008 alle Mitglieder der damaligen EU27 im EU SILC erfasst[^1], während die Daten für die EU28 schon ab 2010 zur Verfügung stehen, obwohl Kroatien erst im Jahr 2013 offiziell Mitglied der EU wurde[^2]. Darüber hinaus sind zum aktuellen Zeitpunkt für 2017 nur Daten für 26 Länder verfügbar, während Großbritannien und Irland fehlen. Wir fokussieren die Analyse daher auf den Zeitraum 2007 bis 2016[^3], wobei der Untersuchungsgegenstand für 2007 bis 2009 die EU27[^4], aber bereits ab 2010 die EU28 ist. Wir beziehen Kroatien bereits ab 2010 ein, da wir der Auffassung sind, dass das intensive Annäherungsverfahren für angehende EU Mitglieder eine frühere Aufnahme in die Berechnungen der Einkommensverteilung durchaus rechtfertigen können, während ein etwaiger Effekt durch den offiziellen Beitritt zudem erst durch die frühere Aufnahme zu beobachten ist.

[^1]: Im Jahr 2007 fehlt jedoch lediglich Malta.
[^2]: Die Daten für die Schweiz, Island, Norwegen und Serbien, welche im Beobachtungszeitraum im EU-SILC ebenfalls teilweise verfügbar sind, werden von der Analyse ausgeschlossen.
[^3]: Sämtliche Berechnungen werden für alle Jahre in denen Daten verfügbar sind durchgeführt, aber nur für diesen Zeitraum untersucht.
[^4]: Da Malta im Jahr 2008 einen Anteil von nur 0,07% der Ungleichheit gemessen am Theil Index für disposable income (P1) der EU27 ausmacht (Siehe [Theil Index]), scheint die Berechnung der Verteilungsmaße für 2007, zumindest als Approximation für die Ungleichheit der EU27, auch ohne Malta gerechtfertigt.

EU-SILC Daten werden jährlich, sowohl auf Haushalts- als auch auf Personenebene, erhoben. Da Einkommen aus unterschiedlichen Quellen hervorgehen und sich zudem auf Haushalts- und Personenebene unterscheiden, definieren wir aus Gründen der Vergleichbarkeit und Reproduzierbarkeit für die vorliegende Untersuchung folgende Einkommensvariablen und Grundgesamtheiten, welche hier kurz beschrieben und im Appendix genau erklärt werden. Zunächst zu den Einkommensvariablen. Beim "pre-tax factor income" handelt es sich um die Summe der Primäreinkommen aus Arbeit und Vermögen, während beim "pre-tax national income" Pensionen und Arbeitslosengeld hinzukommen. Das "post-tax disposable income" stellt schließlich das verfügbare Einkommen, nach Erhalt aller sonstigen staatlichen Transferleistungen und abzüglich aller Steuern und Abgaben, dar. Durch die Gegenüberstellung dieser Einkommensvariablen lässt sich also feststellen, wie die staatliche Umverteilung auf die Einkommensverteilung wirkt.

Da Einkommen sowohl auf Haushalts- als auch auf Personenebene entstehen, wird zur Berechnung von Individualeinkommen eine Konvention benötigt, die festlegt wie die unterschiedlichen Haushaltseinkommen den Personen zugeteilt werden. Aus diesem Grund bilden wir zwei Grundgesamtheiten (P1 und P2), bei welchen diese Zuordnung auf unterschiedliche Weise funktioniert. Im Fall von P1 werden sämtliche Einkommen die in einem Haushalt anfallen (inkl. Einkommen auf Personenebene) summiert, durch einen Äquivalenzfaktor dividiert und anschließend allen Personen in einem Haushalt (auch Kindern) zugeteilt. Der Äquivalenzfaktor berücksichtigt dabei den Umstand, dass in Mehrpersonenhaushalten manche Kosten durch Ressourcenteilung pro Person geringer ausfallen (Waschmaschine, Kühlschrank, etc.) und das verfügbare Einkommen somit höher ist. Bei der Grundgesamtheit P1 wird also davon ausgegangen, dass sämtliche Einkommen eines Haushalts zu gleichen Teilen unter den Bewohnern aufgeteilt werden. Demgegenüber bleiben persönliche Einkommen bei der Grundgesamtheit P2 den jeweiligen Personen vorbehalten, während Einkommen auf Haushaltsebene gleichermaßen auf die Bewohner älter als 19 Jahre aufgeteilt werden, während Personen unter 20 aus den Berechnungen ausgeschlossen werden. Im Fall von P2 werden Ressourcen im Haushalt also nur partiell geteilt.


Nach der Berechnung der Einkommensvariablen für alle Grundgesamtheiten, Länder und Jahre, müssen die Daten noch weiter verarbeitet werden, um die Konstruktion von länderübergreifenden Einkommensverteilungen zu ermöglichen. Zunächst werden die Einkommensdaten sämtlicher Länder im EU-SILC bereits in Euro angegeben. Um diese vergleichbar zu machen, muss aber ebenso berücksichtigt werden, dass sich die Preisniveaus zwischen den Ländern unterscheiden und ein Euro somit je nach Land unterschiedlich viel wert ist. Dazu bereinigen wir die Einkommensvariablen um Kaufkraftparitäten, welche wir von Eurostat beziehen.[^5]

[^5]: Hierbei ist zu beachten, dass Eurostat Euroländer so behandelt, als wäre ihre Landeswährung auch vor dem Beitritt zur Eurozone der Euro gewesen. Deshalb darf für Länder die erst im Beobachtungszeitraum dem Euro beigetreten sind (CY, EE, LT, LV, SK, SI, MT) zur Kaufkraftbereinigung selbst vor dem Beitritt keine Währungsumrechnung erfolgen, da sich die Kaufkraftparitäten bereits auf den Euro als Landeswährung beziehen. Siehe z.B. https://ec.europa.eu/eurostat/cache/metadata/FR/nama10_esms.htm

Schlussendlich erhalten wir national repräsentative Samples mit vergleichbaren Einkommensdaten für alle Jahre im Beobachtungszeitraum. Da unser Ziel jedoch die Untersuchung der länderübergreifenden Einkommensverteilung der EU und nicht die der Einkommensverteilungen der Länder ist, müssen wir darüber hinaus dem Umstand gerecht werden, dass sich die Bevölkerungsgrößen unterscheiden und jedes Land damit unterschiedlich stark in der länderübergreifenden Einkommensverteilung vertreten ist. Auch in diesem Zusammenhang erweist sich die Verwendung von EU-SILC Daten als günstig, da der Faktor Bevölkerungsanzahl bereits in den Stichprobengewichten berücksichtigt ist, welche im Datensatz zur Verfügung gestellt werden. Somit können unter der Verwendung dieser Gewichte Verteilungsmaße für die länderübergreifende Einkommensverteilung der EU berechnet werden.

Um einen ersten Überblick zur Situation der Einkommensungleichheit der EU28 zu geben, haben wir nachfolgend die Einkommensverteilungen für verfügbare- und Primäreinkommen (P1) für das Jahr 2016 in Histogrammen dargestellt. Da, wie gerade besprochen, Ressourcenteilung im Haushalt bereits berücksichtigt wird, zeigt ein kurzer Vergleich der beiden Verteilungen schon auf den ersten Blick die gewaltige Umverteilungsleistung der europäischen Wohlfahrtsstaaten. Des weiteren lassen sich auch enorme Unterschiede in den Positionen, welche die Menschen aus den verschiedenen Staaten in der gemeinsamen EU28 Einkommensverteilung einnehmen, feststellen. So sind zum Beispiel RumänInnen am stärksten in den untersten Einkommensbereichen, Deutsche aber eher im Mittelfeld oder am oberen Ende der Verteilung zu finden.[^6]

[^6]: Zur Konstruktion der dargestellten Einkommensverteilungen werden die nationalen SILC Samples zunächst unter Berücksichtigung der Stichprobengewichte zur Bevölkerungszahl hochgerechnet. Anschließend werden aus der so gewonnenen Bevölkerung erneut Zufallsstichproben in der Größe von 1 Promille der Länderbevölkerung gezogen, um die Rechenanforderungen zu minimieren. Aus den so gewonnenen Samples werden die EU28 Verteilungen mit ca. 500.000 Beobachtungen erstellt. Das oberste und unterste Prozent der Verteilungen wird in einer Stufe zusammengefasst.


```{r echo=FALSE, message=FALSE, warning=FALSE, fig.cap="Histogramm: Gemeinsame Einkommensverteilung der EU28 (2016), Primäreinkommen (P1)", fig.asp=0.55, fig.pos='H'}

load("../../data/sample_distribution.RData")

cmean <- df %>% group_by(rb020) %>% summarise(cmean_eptdi = sum(equivalent_post_tax_disposable_income), cmean_eptfi = sum(equivalent_pre_tax_factor_income))
df <- left_join(df, cmean, by = "rb020")
df <- arrange(df, desc(cmean_eptfi))
df$equivalent_pre_tax_factor_income <- ifelse(df$equivalent_pre_tax_factor_income>=90373.39 , 90373.39  , df$equivalent_pre_tax_factor_income)
df$equivalent_pre_tax_factor_income <- ifelse(df$equivalent_pre_tax_factor_income<(0) , 0, df$equivalent_pre_tax_factor_income)
df$rb020 <- factor(df$rb020, levels = unique(df$rb020))

p <- ggplot(df, aes(x=equivalent_pre_tax_factor_income, y=..count../nrow(df), fill=rb020)) + geom_histogram(binwidth = 1000,stat = "bin") + scale_fill_manual(values = colorRampPalette(brewer.pal(12, "Paired"))(28)) + scale_y_continuous(labels = function(x) paste0(x*100, "%")) + labs(y = "Bevölkerungsanteil", x = "Jahreseinkommen, in Euro (kaufkraftbereinigt)") + guides(fill=guide_legend(title="Länder")) +theme(legend.key.size =  unit(0.15, "in"), axis.title = element_text(size = rel(0.8)))
p
```


```{r echo=FALSE, message=FALSE, warning=FALSE, fig.cap="Histogramm: Gemeinsame Einkommensverteilung der EU28 (2016), verfügbare Einkommen (P1)", fig.asp=0.55, fig.pos='H'}
#load data
#df <- df %>% filter(equivalent_post_tax_disposable_income < 90000 & equivalent_post_tax_disposable_income > -2500)

load("../../data/sample_distribution.RData")
cmean <- df %>% group_by(rb020) %>% summarise(cmean_eptdi = sum(equivalent_post_tax_disposable_income), cmean_eptfi = sum(equivalent_pre_tax_factor_income))
df <- left_join(df, cmean, by = "rb020")
df <- arrange(df, desc(cmean_eptdi))
df$equivalent_post_tax_disposable_income <- ifelse(df$equivalent_post_tax_disposable_income>=63202.19, 63202.19, df$equivalent_post_tax_disposable_income)
df$equivalent_post_tax_disposable_income <- ifelse(df$equivalent_post_tax_disposable_income<=(960.7657), 960.7657, df$equivalent_post_tax_disposable_income)
df$rb020 <- factor(df$rb020, levels = unique(df$rb020))

p <- ggplot(df, aes(x=equivalent_post_tax_disposable_income, y=..count../nrow(df), fill=rb020)) + geom_histogram(binwidth = 1000,stat = "bin") + scale_fill_manual(values = colorRampPalette(brewer.pal(12, "Paired"))(28)) + scale_y_continuous(labels = function(x) paste0(x*100, "%"))  + labs(y = "Bevölkerungsanteil", x = "Jahreseinkommen, in Euro (kaufkraftbereinigt)")+ guides(fill=guide_legend(title="Länder")) +theme(legend.key.size =  unit(0.15, "in"), axis.title = element_text(size = rel(0.8)))
p
```


## Indikatoren

Hier soll ein kurzer theoretischer Überblick zu den verwendeten Indikatoren gegeben werden. Zunächst besprechen wir einige häufig verwendete Verteilungsmaße, während wir anschließend auf die besondere Eignung des Theil Index für die Analyse von länderübergreifenden Einkommensverteilungen eingehen.

### Median und Mittelwert 
Zu Beginn sind der Median und auch der Mittelwert geeignete Indikatoren, um einen erste Eindruck über die Größenverhältnisse zu bekommen. Der Median ist davon besonders aufschlussreich, er ist in anderen Worten das 0,5-Quantil und gibt den mittleren Wert der Einkommen an. 
Der Mittelwert hingegen errechnet sich aus der Summe der Werte dividiert durch die Gesamtheit. Daher kann der Mittelwert durch wenige sehr hohe Einkommen einen hohen Wert annehmen.

### Quantile 
Quantile können beliebig aufgeteilt werden so kann je na Zielsetzung das geeignete Quantil gewählt werden. 
Wir werden die P80/P20 - Rate berechnen, dabei werden die nach der Größe Sortierten Stichproben, in hundert gleich große Gruppen eingeteilt, diese bilden die Perzentile. Für die zu berechnende Rate der oberen 20% Einkommen mit der der Unteren 20% berechnen. Je höher diese Rate ist, desto größer ist die Ungleichheit. 
Zusätzlich analysieren wir den Anteil der obersten 10% der Einkommen.

### Gini und Theil Index
Da unser Fokus auf der Einkommensungleichheit liegt, ist es wichtig ein geeignetes Maß dafür zu nutzen. 
Folgende Eigenschaften sind dabei zu beachten. Zum einen die Symmetrie was so viel bedeutet wie: Wenn Individuen ihr Einkommen untereinander tauschen hat das keinen Effekt auf die Ungleichheit.  Des Weiteren soll die Unabhängigkeit der Populationsgröße und des Mittelwerts gegeben sein, wenn sich die Population verändert oder alle Einkommen sich verdoppeln bleibt die Ungleichheit unverändert. 
Sowie das sogenannte Pigou-Dalton-Prinzip, welches besagt, dass ein Transfer der Einkommen von reich zu arm Ungleichheit reduziert. 
All eben genannten Bedingungen erfüllt der Gini Index, welcher die Ungleichheit auf einem Intervall von 0 bis 1 beschreibt. Bei einem Gini- Index von 0 verdient jedes Individuum in der Population das gleiche, bei einem Gini-Index von 1 verdient eine Person das gesamte Einkommen.
Der Theil Index basiert auf einer anderen Berechnung, welche den Vorteil hat, dass zu den vier eben genannten Bedingungen zerlegbar ist und man beispielsweise Untergruppen bilden kann, das ist mit dem Gini nicht möglich. 
Das Minimum des Theil Indices ist 0 wie auch beim Gini und ln(N) das Maximum. 
Der T(1) berechnet sich wie folgt $$T(1) = \frac{1}{N} \sum_{i=1}^{N}(\frac{y_i}{\mu})ln(\frac{y_i}{\mu})$$ 


|Variable  |Beschreibung | 
| ---     | ---   | 
| N    | Population   | 
| $y_i$    | individuelles Einkommen   | 
| $\mu$   | Mittelwert des Einkommens der Population   | 

Wir machen uns die Eigenschaft der Zerlegbarkeit folgendermaßen zu Nutze

$$T(1) = \sum_{k=1}^K s_k \times T(1)_k + \sum_{k=1}^K s_k ln(\frac{\mu_k}{\mu}) $$wobei$$ s_k = \frac{\sum_{j=1}^{N_k}y_j}{\sum_{i=1}^{N}y_i} = \frac{N_k * mu_k}{N * mu}$$

|Variable  |Beschreibung | 
| ---     | ---   | 
| K   | Population Untergruppe  | 
| $s_k$    | Anteil des Einkommens der Untergruppe k   |
| $T(1)_k$    | Theil Index der Untergruppe k   | 
| $\mu$   | Mittelwert des Einkommens  |
| $\mu_k$   | Mittelwert des Einkommens der Untergruppe k   |

Der Vorteil des Theil Indexes ist die Eigenschaft der Zerlegbarkeit, somit kann man die ungleichheit innerhalb einer Gruppe untersuchen sowie die Ungleichheilt zwischen den Gruppen. Wir haben unsere Gesamtheit des EU28-Landes in die 28 Mitgliedsländer unterteilt. Damit ist es möglich die Anteile der einzelnen Länder aufzuzeigen, sowie das ökonomische Gewicht innerhalb des EU28-Landes.(@Kranzinger)



# Einkommensungleichheit in der EU

In diesem Abschnitt beschreiben wir die länderübergreifende Einkommensverteilung der EU. Dabei konzentrieren wir uns auf die Grundggesamtheit P1 und auf verfügbare Einkommen. Die Ergebnisse für P2 finden sich im Appendix. Zunächst werden einige häufig verwendete Verteilungsmaße dargestellt. Anschließend werden die Ergebnisse für die Zerlegung des Teil Index im Detail diskutiert.


## Basisindikatoren

Um einen ersten Eindruck zu bekommen, wie sich die länderübergreifende Einkommensverteilung der EU im Zeitraum von 2007 bis 2016 entwickelt hat, wenden wir uns zunächst den bereits beschriebenen Indikatoren zu. Wie sich Tabelle 3 entnehmen lässt, scheint die Ungleichheit der Einkommensverteilung EU in den letzten Jahren im Allgemeinen gesunken zu sein. Zu einem ähnlichen Ergebnis kommen wir, wenn wir uns die gleiche Tabelle für partielle Ressourcenteilung in den Haushalten (Grundgesamtheit P2) vor Augen führen (siehe Appendix). Dort ist aber zu bemerken, dass der relative Unterschied zwischen Median- und Durchschnittseinkommen wächst, während er in Tabelle 3 annähernd gleich bleibt.


```{r echo=FALSE, message=FALSE, warning=FALSE}

data_di <- indicators.p1 %>% select(-contains("dii"), -contains("fii"))

data_di <- data_di %>% select(year, contains("eptdi"))
data_di <- mutate_all(data_di, function(x) as.double(as.character(x)))
data_di <- data_di %>% mutate_at(vars(starts_with("qsr"):starts_with("theil")), funs(round(., 4)))
colnames(data_di) <- c("Jahr", "Mittelwert", "Median", "80/20 Quantile Share Ratio", "Top 10% Anteil", "Gini", "Theil")

knitr::kable(data_di, caption = "Basisindikatoren, verfügbare Einkommen (P1), 2007 - 2016")

```




In Abbildung 3 kann man insgesamt einen Anstieg bei den Medianeinkommen sowie bei den mittleren Einkommen beobachten. In dieser Grafik haben wir zusätzlich zu den verfügbaren Einkommen (eptdi) auch das Primäreinkommen (eptfi) und das Primäreinkommen inkl. Arbeitslosengeld und Pensionen (epdni) dargestellt. Dabei zeigt sich, dass in Krisenjahren wie 2009 und 2013 Median und Mittelwert des Primäreinkommens zwar fallen, Median und Mittelwert der verfügbaren Einkommen aber annähernd konstant bleiben. Dies deutet auf die stabilisierende Wirkung der Wohlfahrtsstaaten hin, die sich auch auf EU Ebene bemerkbar macht. Interessanterweise liegt der Median der verfügbaren Einkommen über dem Median der Primäreinkommen, obwohl die Anzahl der positiven verfügbaren Einkommen höher ist, was ebenso den Effekt der Umverteilung auf die Ungleichheit andeutet.




```{r echo=FALSE, message=FALSE, warning=FALSE, fig.cap="Mittelwert und Median, EU (P1)", fig.asp=0.4, fig.pos='H'}

p <- ggplot()
p <- p + geom_line(data = indicators.p1, aes(x=year, y=mean_eptdi, colour = "verf. Einkommen", linetype = "Mittelwert")) + xlab("") + ylab("")
p <- p + geom_line(data = indicators.p1, aes(x=year, y=mean_eptni, colour = "Nationaleinkommen", linetype = "Mittelwert"))
p <- p + geom_line(data = indicators.p1, aes(x=year, y=mean_eptfi, colour = "Primäreinkommen", linetype = "Mittelwert"))
p <- p + geom_line(data = indicators.p1, aes(x=year, y=median_eptdi, colour = "verf. Einkommen", linetype = "Median")) 
p <- p + geom_line(data = indicators.p1, aes(x=year, y=median_eptni, colour = "Nationaleinkommen", linetype = "Median"))
p <- p + geom_line(data = indicators.p1, aes(x=year, y=median_eptfi, colour = "Primäreinkommen", linetype = "Median"))
p <- p + guides(colour=guide_legend(title="Einkommensvariable"), linetype=guide_legend(title="Indikator")) + labs(y="Euro (kaufkraftbereinigt)")
p

```




Die 80/20 Rate für verfügbare Einkommen in Abbildung 4 zeigt auf, dass das 80. Perzentil 2016 ungefähr das 6-fache vom 20. Perzentil verdiente, während es 2007 noch etwa das 7-fache war. Dieser Rückgang lässt sich jedoch bei den Primäreinkommen nicht beobachten. Auch die 80/20 Rate zeigt, dass die verfügbaren Einkommen in der EU wesentlich egalitärer verteilt sind als die Primäreinkommen. Für den Top 10% Einkommensanteil (Abbildung 5) zeigt sich eine ähnliche Entwicklung. Im Jahr 2016 verdienen die obersten 10% der Einkommensverteilung rund 25% der gesamten verfügbaren Einkommen und rund 32% der Primäreinkommen.



```{r echo=FALSE, message=FALSE, warning=FALSE, , fig.cap="80/20 Perzentilsverhältnis, EU (P1)", fig.asp=0.4, , fig.pos='H'}

p <- ggplot()
p <- p + geom_line(data = indicators.p1, aes(x=year, y=qsr8020_eptdi, colour = "verf. Einkommen")) + xlab("") + ylab("")
p <- p + geom_line(data = indicators.p1, aes(x=year, y=qsr8020_eptni, colour = "Nationaleinkommen")) 
p <- p + geom_line(data = indicators.p1, aes(x=year, y=qsr8020_eptfi, colour = "Primäreinkommen")) + guides(colour=guide_legend(title="Einkommensvariable"))
p

```



```{r echo=FALSE, message=FALSE, warning=FALSE, , fig.cap="Top 10% Einkommensanteil, EU (P1)", fig.asp=0.4, fig.pos='H'}

g <- ggplot()
g <- g + geom_line(data = indicators.p1, aes(x=year, y=top10_eptdi, colour = "verf. Einkommen")) + xlab("") + ylab("")
g <- g + geom_line(data = indicators.p1, aes(x=year, y=top10_eptni, colour = "Nationaleinkommen")) 
g <- g + geom_line(data = indicators.p1, aes(x=year, y=top10_eptfi, colour = "Primäreinkommen")) + guides(colour=guide_legend(title="Einkommensvariable")) + scale_y_continuous(labels = function(x) paste0(x*100, "%"))
g

```


Gini und Theil Index (Abbildung 6) zeigen ebenso einen leichten Abwärtstrend. Für die verfügbaren Einkommen liegt der Gini im Jahr 2016 bei 33,94% und der Theil bei 20,98%, während diese Werte 2007 noch bei 35,59% bzw. 22,63% lagen.


```{r echo=FALSE, message=FALSE, warning=FALSE, , fig.cap="Gini und Theil Index, EU (P1)", fig.asp=0.4, fig.pos='H'}

p <- ggplot()
p <- p + geom_line(data = indicators.p1, aes(x=year, y=gini_eptdi, colour = "verf. Einkommen", linetype = "Gini")) + xlab("") + ylab("")
p <- p + geom_line(data = indicators.p1, aes(x=year, y=gini_eptni, colour = "Nationaleinkommen", linetype = "Gini"))
p <- p + geom_line(data = indicators.p1, aes(x=year, y=gini_eptfi, colour = "Primäreinkommen", linetype = "Gini"))
p <- p + geom_line(data = indicators.p1, aes(x=year, y=theil_eptdi, colour = "verf. Einkommen", linetype = "Theil"))
p <- p + geom_line(data = indicators.p1, aes(x=year, y=theil_eptni, colour = "Nationaleinkommen", linetype = "Theil"))
p <- p + geom_line(data = indicators.p1, aes(x=year, y=theil_eptfi, colour = "Primäreinkommen", linetype = "Theil")) + guides(colour=guide_legend(title="Einkommensvariable"), linetype=guide_legend(title="Indikator"))
p

```



Vergleicht man die eben angeführten Indikatoren mit den Ergebnissen für die Grundgesamtheit P2 (Siehe Appendix), so zeigen sich im Wesentlichen die gleichen Entwicklungen, aber auf einem höheren Niveau der Ungleichheit. Dies lässt sich dadurch erklären, dass im Gegensatz zu P1 Ressourcen im Haushalt nur partiell geteilt werden. Somit reflektiert P1 eher die Ungleichheit zwischen den Haushalten und P2 eher jene zwischen Personen.



## Theil Index 

Zusätzlich zu den Basisindikatoren beschäftigen wir uns näher mit dem Theil Index und machen uns dabei, wie oben beschrieben, die additive Zerlegbarkeit dieses Verteilungsmaßes zu Nutze. Durch diese Eigenschaft können wir den Theil Index in zwei Komponenten zerlegen. Eine Komponente gibt dabei den Teil des Theil Indexes an, der auf die Ungleichheit innerhalb der EU Länder zurückzuführen ist. Die andere Komponente beschreibt den Teil des Theil Indexes der durch die Ungleichheit zwischen den Ländern zustande kommt. Darüber hinaus können die Anteile aller einzelnen Länder am Theil Index berechnet werden. Der Rest stellt dann die "between inequality share" dar, also jenen Anteil am Theil, der durch die Ungleichheit zwischen den Ländern zu erklären ist. Wir berechnen im ersten Schritt die Theil Indices aller Länder mit Hilfe der EU-SILC Daten. Danach berechnen wir die ökonomischen Gewichte mittels Daten zur Bevölkerungsanzahl von Eurostat und den Durchschnittseinkommen aus dem EU-SILC. Damit berechnen wir in Folge den Theil der EU28 und seine Komponenten bzw. die Ungleichheitsanteile. Wie bereits bei @beblo2001measuring und @kranzinger2018decomposition stellen wir diese Theil Index Zerlegung für die Jahre 2010 und 2016 für die verfügbaren Einkommen (P1) der EU28 in Form von Tabellen (4 & 5) dar. 

Aus den Tabellen ist ersichtlich, dass der größte Teil der Ungleichheit der Einkommensverteilung der EU28 gemessen am Theil durch die Ungleichheit in jenen Ländern erklärt werden kann, die ein hohes ökonomisches Gewicht, also viele Einwohner und hohe Durchschnittseinkommen, aufweisen. Dazu zählen natürlich allen voran Deutschland, Großbritannien, Frankreich und Italien. Diese vier Länder allein machen im Beobachtungszeitraum etwa 50% des Theil Indexes aus. Aber auch die Ungleichheit zwischen den Ländern hat einen Anteil von 19,8% (2010) bzw. 17,9% (2016). Auffällig ist, dass dieser Anteil der Ungleichheit zwischen den Ländern für P2 um einiges geringer ausfällt (siehe Appendix). Dies liegt allerdings eher daran, dass die Ungleichheit in allen Ländern durch partielle Ressourcenteilung höher ausfällt und diese dadurch einen höheren Anteil an der Ungleichheit haben, während sich die Ungleichheit zwischen den Ländern, die sich im Theil durch die Durchschnittseinkommen niederschlägt, weniger stark verändert.

Allgemein fällt der Theil von 2010 auf 2016 minimal. Die Unterschiede innerhalb der Länder sind allerdings größer, so fällt der Theil in Österreich um etwa einen Prozentpunkt. Die Entwicklungen sind aber unterschiedlich, bei einigen Ländern steigt der Theil Index, besonders stark beispielsweise in Dänemark, in anderen Ländern, wie der Slowakei und Belgien, fällt er. Abbildung 7 bietet dazu einen Überblick.


```{r echo=FALSE, warning=FALSE}

theil.p1 <- slice(theil.p1,1:29)

theil.p1.t <- theil.p1 %>% select(-contains("fi."), -contains("ni."))

theil_2010.p1 <- theil.p1.t %>% select( contains("2010"))
theil_2016.p1 <- theil.p1.t %>% select( contains("2016"))

theil_2010.p1$countries2010 <- as.character(theil_2010.p1$countries2010)

theil_2010.p1[30,1] <- "EU28"

theil_2016.p1$countries2016 <- as.character(theil_2016.p1$countries2016)
theil_2016.p1[30,1] <- "EU28"





theil_2010.p1 <- theil_2010.p1 %>% mutate_at(vars(contains("theil"):contains("share")), function(x) as.double(as.character(x)))
theil_2010.p1 <- theil_2010.p1 %>% mutate_at(vars(contains("theil"):contains("weight"):contains("share")), funs(round(., 4)))

theil_2016.p1 <- theil_2016.p1 %>% mutate_at(vars(contains("theil"):contains("weight"):contains("share")), function(x) as.double(as.character(x)))
theil_2016.p1 <- theil_2016.p1 %>% mutate_at(vars(contains("theil"):contains("weight"):contains("share")), funs(round(., 4)))


theil_2010.p1[30,2] <- 0.1960
theil_2016.p1[30,2] <- 0.1926


colnames(theil_2010.p1) <- c("Länder", "Theil 2010", "Theil 2016", "Economic Weight", "Inequality Share")
colnames(theil_2016.p1) <- c("Länder", "Theil 2010", "Theil 2016", "Economic Weight", "Inequality Share")


knitr::kable(theil_2010.p1, caption = "Theil Index Zerlegung, verfügbare Einkommen (P1), 2010")
knitr::kable(theil_2016.p1, caption = "Theil Index Zerlegung, verfügbare Einkommen (P1), 2016")

```

```{r echo=FALSE, message=FALSE, warning=FALSE, fig.cap="Entwicklung der Theil Indices der Länder, verfügbare Einkommen , EU28 (P1)", fig.asp=0.6, fig.pos='H'}
theil.vgl <- slice(theil.p1,1:28)
theil.vgl <- theil.vgl %>% select(countries2010, di.theil2010, di.theil2016)
theil.vgl <- theil.vgl %>% mutate_at(vars(di.theil2010, di.theil2016), function(x) as.double(as.character(x)))

# ggplot(theil.vgl) +
#   geom_segment( aes(x=countries2010, xend=countries2010, y=di.theil2010, yend=di.theil2016), color="grey") +
#   geom_point( aes(x=countries2010, y=di.theil2010, colour = "2010"), size=3 ) +
#   geom_point( aes(x=countries2010, y=di.theil2016, colour = "2016"), size=3 ) + xlab("") + ylab("")  + 
#   coord_flip() 


p <- ggplot(theil.vgl) +
  geom_segment( aes(x=factor(countries2010, level=countries2010), xend=factor(countries2010, level=countries2010), y=di.theil2010, yend=di.theil2016), color="blue",  arrow = arrow(angle = 30, length = unit(0.2, "inches"), ends = "last", type = "open")) +
  xlab("") + ylab("Theil Index 2010 und 2016\n")  + scale_y_continuous(breaks = pretty(theil.vgl$di.theil2016, n=15))+ theme(axis.title = element_text(size = rel(0.8))) 
p

```


Abbildung 8 zeigt die Entwicklung der Ungleichheitsanteile am Theil im Zeitverlauf. Dieser Grafik lässt sich entnehmen, dass die Ungleichheit zwischen den Ländern gesunken ist bzw. einen kleineren Anteil vom Theil Index ausmacht. Das sieht man daran, dass der Anteil der einzelnen Länder am Theil insgesamt gestiegen ist. Die Komponente des Theils die die Ungleichheit zwischen den Ländern angibt, ist in dieser Grafik die Differenz auf 100%. Es ist ersichtlich, dass die Ungleichheit in den Ländern während der Krise steigt. Weiters trägt Frankreich 2016 einen größeren Anteil zur Ungleichheit bei als noch 2007.

```{r echo=FALSE, message=FALSE, warning=FALSE, fig.cap="Theil Index Inequality Shares der verfügbaren Einkommen (P1)", fig.asp=0.55, fig.pos='H'}

theil.melt.c <- theil.p1 %>% select(contains("countries"))
theil.melt.i <- theil.p1 %>% select(contains("di.ineq.share"))

theil.melt.c <- melt(theil.melt.c, measure.vars =  colnames(theil.melt.c)[1:10], variable.name = "c", value.name="countries")
theil.melt.i <- melt(theil.melt.i, measure.vars =  colnames(theil.melt.i)[1:10], variable.name = "i", value.name="ineq.share")

theil.i.ts <- cbind(theil.melt.c, theil.melt.i)
theil.i.ts <- theil.i.ts %>% mutate(year = str_sub(i, start = -4))
theil.i.ts <- na.exclude(theil.i.ts)
theil.i.ts <- theil.i.ts %>% filter(countries != "between")
avgshare <- theil.i.ts %>% group_by(countries) %>% summarise(cmean = mean(as.numeric(ineq.share)))
theil.i.ts <- left_join(theil.i.ts, avgshare, by="countries")
theil.i.ts <- theil.i.ts %>% arrange(year, desc(cmean))
theil.i.ts$countries <- factor(theil.i.ts$countries, levels = unique(theil.i.ts$countries))


t <- ggplot(theil.i.ts, aes(x = as.numeric(year), y = as.numeric(ineq.share), fill = countries)) + geom_area() + ylab("") + xlab("")+ scale_fill_manual(values = colorRampPalette(brewer.pal(12, "Paired"))(28))+ scale_y_continuous(labels = function(x) paste0(x*100, "%")) + labs(y = "Anteil am Theil (EU27/28)", x = "") + guides(fill=guide_legend(title="Länder")) +theme(legend.key.size =  unit(0.15, "in"), axis.title = element_text(size = rel(0.8)))
t

# t <- ggplot(theil.i.ts, aes(x = as.numeric(year), y = as.numeric(ineq.share))) + geom_line(data= indicators.p1, aes(x = as.numeric(year), y=as.numeric(theil_di_manual), colour = "theil_di")) + geom_text(aes(label = countries)) + ylab("") + xlab("")
# t

```


# Conclusio

In dieser Arbeit geben wir einen Überblick zum Stand und zur Entwicklung der länderübergreifenden Einkommensverteilung der EU im Zeitraum von 2007 bis 2016 auf Basis von EU-SILC Daten. Wir berechnen gängige Verteilungsmaße für drei unterschiedliche Einkommensvariablen und zwei Grundgesamtheiten. Darüber hinaus führen wir eine Theil Index Zerlegung durch.


# Appendix

## Appendix A: Definitionen von Einkommensvariablen und Grundgesamtheiten

### Einkommensvariablen

**1. Pre-tax factor income (Canberra: primary income)**

Summe aus:

(1) Einkommen aus Arbeit (inkl. Selbstständige)

    - gross employee cash or near cash income (PY010G), 
    - company car (PY021G), 
    - gross cash benefits or losses from self-employment (including royalties) (PY050G),
    - income received by people aged under 16 (HY110G);

(2) Vermögenseinkommen

    - income from rental of a property or land (HY040G),
    - interests, dividends, profit from capital investments in unincorporated business (HY090G),
    - pensions received from individual private plans (PY080G),

**2. Pre-tax national income**

(1) $+$ 
(2) $+$

(3) Pensionen + Arbeitslosengeld

    - unemployment benefits (PY090G), 
    - old-age benefits (PY100G),

**3. Post-tax disposable income**

(1) $+$ 
(2) $+$ 
(3) $+$

(4) Alle anderen erhaltenen Transferzahlungen

    - survivor' benefits (PY110G), 
    - sickness benefits (PY120G), 
    - disability benefits (PY130G), 
    - education-related allowances (PY140G);
    - family/children related allowances (HY050G), 
    - social exclusion not elsewhere classified (HY060G), 
    - housing allowances (HY070G), 
    - regular inter-household cash transfers received (HY080G),

(5) abzüglich aller Steuern und Sozialversicherungsabgaben

    - regular taxes on wealth (HY120G), 
    - regular inter-household cash transfer paid (HY130G), 
    - tax on income and social insurance contributions (HY140G).

 

### Grundgesamtheiten

Einige Einkommenskomponenten sind nur auf Haushaltsebene verfügbar. Diese Einkommensvariablen sollen auf zwei unterschiedlichen Varianten auf die Individuen aufgeteilt werden. Innerhalb der beiden Grundgesamtheiten werden keine weiteren Anpassungen des Samples vorgenommen, dh. alle Indikatoren im Bereich P1 und P2 werden jeweils mit der gleichen Anzahl an Beobachtungen berechnet.


**P1 (Eurostat): Gesamte Bevölkerung & equal sharing of resources within household. **

Zunächst wird die Summe der entsprechenden Einkommen pro Haushalt gebildet und anschließend durch den Äquivalenzfaktor (hx050) dividiert. Dieses Äquivalenzeinkommen wird dann allen Personen pro Haushalt (auch jenen unter 16 Jahren, daher SILC – Personenregister, Tabelle R) zugeordnet.


**P2 (wid.world): Nur Personen >= 20 Jahre & partial sharing of resources **

In diesem Fall werden die Einkommensaggregate so gebildet, dass persönliche Einkommen den jeweiligen Personen vorbehalten bleiben und Einkommensarten die nur auf Haushaltsebene verfügbar sind durch die Anzahl der HH Mitglieder >= 20 Jahren dividiert und allen zu gleichen Teilen zugeordnet werden. Personen unter 20 Jahren werden vor der Berechnung der Ungleichheitsindikatoren ausgeschlossen. 


## Appendix B: Auswertungen zu P2


```{r echo=FALSE, message=FALSE, warning=FALSE}

data_di_p2 <- indicators.p2 %>% select(-contains("dii"), -contains("fii"))

data_di_p2 <- data_di_p2 %>% select(year, contains("ptdi"))
data_di_p2 <- mutate_all(data_di_p2, function(x) as.double(as.character(x)))
data_di_p2 <- data_di_p2 %>% mutate_at(vars(starts_with("qsr"):starts_with("theil")), funs(round(., 4)))

colnames(data_di_p2) <- c("Jahr", "Mittelwert", "Median", "80/20 Quantile Share Ratio", "Top 10% Anteil", "Gini", "Theil")

knitr::kable(data_di_p2, caption = "Basisindikatoren, verfügbare Einkommen (P2), 2007 - 2016")
```

```{r echo=FALSE, warning=FALSE, message=FALSE}



theil.p2 <- slice(theil.p2,1:29)

theil.p2.t <- theil.p2 %>% select(-contains("fi."), -contains("ni."))

theil_2010.p2 <- theil.p2.t %>% select( contains("2010"))
theil_2016.p2 <- theil.p2.t %>% select( contains("2016"))

theil_2010.p2 <- theil_2010.p2 %>% mutate_at(vars(contains("theil"):contains("weight"):contains("share")), function(x) as.double(as.character(x)))
theil_2010.p2 <- theil_2010.p2 %>% mutate_at(vars(contains("theil"):contains("weight"):contains("share")), funs(round(., 4)))

theil_2016.p2 <- theil_2016.p2 %>% mutate_at(vars(contains("theil"):contains("weight"):contains("share")), function(x) as.double(as.character(x)))
theil_2016.p2 <- theil_2016.p2 %>% mutate_at(vars(contains("theil"):contains("weight"):contains("share")), funs(round(., 4)))

theil_2010.p2$countries2010 <- as.character(theil_2010.p2$countries2010)
theil_2010.p2[30,1] <- "EU28"

theil_2016.p2$countries2016 <- as.character(theil_2016.p2$countries2016)
theil_2016.p2[30,1] <- "EU28"

theil_2010.p2[30,2] <- 0.3296
theil_2016.p2[30,2] <- 0.3198


colnames(theil_2010.p2) <- c("Länder", "Theil 2010", "Theil 2016", "Economic Weight", "Inequality Share")
colnames(theil_2016.p2) <- c("Länder", "Theil 2010", "Theil 2016", "Economic Weight", "Inequality Share")

knitr::kable(theil_2010.p2, caption = "Theil Index Zerlegung, verfügbare Einkommen (P2), 2010")
knitr::kable(theil_2016.p2, caption = "Theil Index Zerlegung, verfügbare Einkommen (P2), 2016")
```


```{r echo=FALSE, message=FALSE, warning=FALSE, fig.cap="Entwicklung der Theil Indices der Länder, verfügbare Einkommen (P2)", fig.asp=0.6, fig.pos='H'}
theil.vgl <- slice(theil.p2,1:28)
theil.vgl <- theil.vgl %>% select(countries2010, di.theil2010, di.theil2016)
theil.vgl <- theil.vgl %>% mutate_at(vars(di.theil2010, di.theil2016), function(x) as.double(as.character(x)))

# ggplot(theil.vgl) +
#   geom_segment( aes(x=countries2010, xend=countries2010, y=di.theil2010, yend=di.theil2016), color="grey") +
#   geom_point( aes(x=countries2010, y=di.theil2010, colour = "2010"), size=3 ) +
#   geom_point( aes(x=countries2010, y=di.theil2016, colour = "2016"), size=3 ) + xlab("") + ylab("")  + 
#   coord_flip() 

p <- ggplot(theil.vgl) +
  geom_segment( aes(x=factor(countries2010, level=countries2010), xend=factor(countries2010, level=countries2010), y=di.theil2010, yend=di.theil2016), color="blue",  arrow = arrow(angle = 30, length = unit(0.2, "inches"), ends = "last", type = "open")) +
  xlab("") + ylab("Theil Index 2010 und 2016\n")  + scale_y_continuous(breaks = pretty(theil.vgl$di.theil2016, n=15)) + theme(axis.title = element_text(size = rel(0.8))) 
p

```



```{r echo=FALSE, message=FALSE, warning=FALSE, fig.cap="Mittelwert und Median, (P2)", fig.asp=0.4, fig.pos='H'}

p <- ggplot()
p <- p + geom_line(data = indicators.p2, aes(x=year, y=mean_ptdi, colour = "ptdi", linetype = "mean")) + xlab("") + ylab("")
p <- p + geom_line(data = indicators.p2, aes(x=year, y=mean_ptni, colour = "ptni", linetype = "mean"))
p <- p + geom_line(data = indicators.p2, aes(x=year, y=mean_ptfi, colour = "ptfi", linetype = "mean"))
p <- p + geom_line(data = indicators.p2, aes(x=year, y=median_ptdi, colour = "ptdi", linetype = "median")) 
p <- p + geom_line(data = indicators.p2, aes(x=year, y=median_ptni, colour = "ptni", linetype = "median"))
p <- p + geom_line(data = indicators.p2, aes(x=year, y=median_ptfi, colour = "ptfi", linetype = "median"))

p

```


```{r echo=FALSE, message=FALSE, warning=FALSE, fig.cap="80/20 Perzentilsverhältnis, (P2)", fig.asp=0.4, fig.pos='H'}

p <- ggplot()
p <- p + geom_line(data = indicators.p2, aes(x=year, y=qsr8020_ptdi, colour = "ptdi")) + xlab("") + ylab("")
p <- p + geom_line(data = indicators.p2, aes(x=year, y=qsr8020_ptni, colour = "ptni")) 
p <- p + geom_line(data = indicators.p2, aes(x=year, y=qsr8020_ptfi, colour = "ptfi")) 
p

```

```{r echo=FALSE, message=FALSE, warning=FALSE, fig.cap="Top 10% Einkommensanteil, (P2)", fig.asp=0.4, fig.pos='H'}

g <- ggplot()
g <- g + geom_line(data = indicators.p2, aes(x=year, y=top10_ptdi, colour = "ptdi")) + xlab("") + ylab("")
g <- g + geom_line(data = indicators.p2, aes(x=year, y=top10_ptni, colour = "ptni")) 
g <- g + geom_line(data = indicators.p2, aes(x=year, y=top10_ptfi, colour = "ptfi"))
g

```


```{r echo=FALSE, message=FALSE, warning=FALSE, fig.cap="Gini und Theil Index (P2)", fig.asp=0.4, fig.pos='H'}

p <- ggplot()
p <- p + geom_line(data = indicators.p2, aes(x=year, y=gini_ptdi, colour = "ptdi", linetype = "gini")) + xlab("") + ylab("")
p <- p + geom_line(data = indicators.p2, aes(x=year, y=gini_ptni, colour = "ptni", linetype = "gini"))
p <- p + geom_line(data = indicators.p2, aes(x=year, y=gini_ptfi, colour = "ptfi", linetype = "gini"))
p <- p + geom_line(data = indicators.p2, aes(x=year, y=theil_ptdi, colour = "ptdi", linetype = "theil"))
p <- p + geom_line(data = indicators.p2, aes(x=year, y=theil_ptni, colour = "ptni", linetype = "theil"))
p <- p + geom_line(data = indicators.p2, aes(x=year, y=theil_ptfi, colour = "ptfi", linetype = "theil"))
p

```



```{r echo=FALSE, message=FALSE, warning=FALSE, fig.cap="Theil Index Inequality Shares der verfügbaren Einkommen (P2)", fig.asp=0.55, fig.pos='H'}

theil.melt.c <- theil.p2 %>% select(contains("countries"))
theil.melt.i <- theil.p2 %>% select(contains("di.ineq.share"))

theil.melt.c <- melt(theil.melt.c, measure.vars =  colnames(theil.melt.c)[1:10], variable.name = "c", value.name="countries")
theil.melt.i <- melt(theil.melt.i, measure.vars =  colnames(theil.melt.i)[1:10], variable.name = "i", value.name="ineq.share")

theil.i.ts <- cbind(theil.melt.c, theil.melt.i)
theil.i.ts <- theil.i.ts %>% mutate(year = str_sub(i, start = -4))
theil.i.ts <- na.exclude(theil.i.ts)
theil.i.ts <- theil.i.ts %>% filter(countries != "between")
avgshare <- theil.i.ts %>% group_by(countries) %>% summarise(cmean = mean(as.numeric(ineq.share)))
theil.i.ts <- left_join(theil.i.ts, avgshare, by="countries")
theil.i.ts <- theil.i.ts %>% arrange(year, desc(cmean))
theil.i.ts$countries <- factor(theil.i.ts$countries, levels = unique(theil.i.ts$countries))

t <- ggplot(theil.i.ts, aes(x = as.numeric(year), y = as.numeric(ineq.share), fill = countries)) + geom_area() + ylab("") + xlab("")+ scale_fill_manual(values = colorRampPalette(brewer.pal(12, "Paired"))(28))+ scale_y_continuous(labels = function(x) paste0(x*100, "%")) + labs(y = "Anteil am Theil (EU27/28)", x = "") + guides(fill=guide_legend(title="Länder")) +theme(legend.key.size =  unit(0.15, "in"), axis.title = element_text(size = rel(0.8)))
t

```




# References

